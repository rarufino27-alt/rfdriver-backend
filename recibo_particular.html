<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Recibo Particular - Fluxo Driver</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --gold-dark:#d6b25f;
  --gold-dark2:#e8d08a;

  --gold-light:#90731b;
  --gold-light2:#b08c2e;

  --bg-dark:#0d0d0d;
  --text-dark:#f4f4f4;
  --card-dark:#161616;
  --border-dark:#242424;

  --bg-light:#f7f7f7;
  --text-light:#222;
  --card-light:#ffffff;
  --border-light:#d6d6d6;

  --radius:14px;
}

body.dark{
  --bg:var(--bg-dark);
  --text:var(--text-dark);
  --card:var(--card-dark);
  --border:var(--border-dark);
  --gold-main:var(--gold-dark);
  --gold-main2:var(--gold-dark2);
}
body.light{
  --bg:var(--bg-light);
  --text:var(--text-light);
  --card:var(--card-light);
  --border:var(--border-light);
  --gold-main:var(--gold-light);
  --gold-main2:var(--gold-light2);
}

*{ box-sizing:border-box; font-family:Inter,system-ui; }

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  padding-top:70px;
  padding-bottom:100px;
}

/* Drawer lateral */
.drawer{
  position:fixed; top:0; left:-260px;
  width:260px; height:100%;
  background:var(--card); transition:.3s;
  z-index:9999; padding-top:70px;
}
.drawer.open{ left:0; }
.drawer a{
  display:block; padding:14px 22px;
  border-bottom:1px solid var(--border);
  text-decoration:none; color:var(--text);
}

.drawer-toggle{
  position:fixed; left:15px; top:15px; z-index:10000;
  background:var(--gold-main);
  padding:7px 12px; border-radius:10px; color:#000;
  font-size:23px; cursor:pointer;
}

/* Bot√£o tema */
.theme-toggle{
  position:fixed; right:15px; top:15px; z-index:10001;
  background:var(--card); padding:6px 10px; border-radius:10px;
  font-size:22px; cursor:pointer;
}

/* Header */
.page-header{
  padding:0 20px 10px;
}
h1{
  margin:0;
  font-size:30px;
  font-weight:800;
  color:var(--gold-main);
}
.sub{
  font-size:14px;
  opacity:.8;
}

/* Tabs internas */
.tabs{
  display:flex; gap:10px; margin-top:12px;
}
.tab-btn{
  flex:1;
  background:var(--card);
  border:1px solid var(--border);
  padding:10px;
  border-radius:999px;
  cursor:pointer;
  font-weight:700;
  color:var(--text);
  text-align:center;
}
.tab-btn.active{
  background:linear-gradient(90deg,var(--gold-main),var(--gold-main2));
  border:none;
  color:#000;
}

/* Container */
.container{
  padding:0 20px 20px;
}

/* Cards / forms */
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:18px;
  margin-top:16px;
}
.card h3{margin-top:0;margin-bottom:10px;}

label{
  display:block;
  margin-top:10px;
  font-size:13px;
}
input,select,textarea{
  width:100%;
  margin-top:6px;
  padding:11px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--text);
}
textarea{
  resize:vertical;
  min-height:80px;
}

.row{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
}
.col{
  flex:1;
  min-width:120px;
}

button{
  padding:12px;
  border:none;
  border-radius:10px;
  background:linear-gradient(90deg,var(--gold-main),var(--gold-main2));
  cursor:pointer;
  font-weight:700;
  color:#000;
  margin-top:12px;
}

/* Hist√≥rico */
.hist-item{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  padding:12px;
  margin-bottom:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:14px;
}
.hist-main{
  display:flex;
  flex-direction:column;
  gap:2px;
}
.hist-main span{
  font-size:12px;
  opacity:.7;
}
.hist-actions{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.btn-sm{
  padding:6px 10px;
  border-radius:8px;
  border:none;
  font-size:12px;
  font-weight:700;
  cursor:pointer;
}
.btn-sm.pdf{
  background:linear-gradient(90deg,var(--gold-main),var(--gold-main2));
  color:#000;
}
.btn-sm.del{
  background:#e11d48;
  color:#fff;
}

/* Tabbar inferior */
.tabbar{
  position:fixed;
  bottom:0; left:0; right:0;
  height:70px;
  background:var(--card);
  border-top:1px solid var(--border);
  display:flex;
  justify-content:space-around;
  align-items:center;
  z-index:9990;
}
.tabbar a{
  text-decoration:none;
  color:var(--text);
  font-size:20px;
  text-align:center;
}
.tabbar small{
  display:block;
  font-size:12px;
}
.action-btn{
  width:58px; height:58px;
  border-radius:50%;
  background:linear-gradient(90deg,var(--gold-main),var(--gold-main2));
  border:none;
  font-size:26px;
  margin-top:-35px;
  color:#000;
}
</style>
</head>

<body class="light">

<!-- Bot√µes topo -->
<div class="drawer-toggle" onclick="toggleDrawer()">‚ò∞</div>
<div id="toggleTheme" class="theme-toggle" onclick="toggleTheme()">üåì</div>

<!-- Drawer lateral -->
<nav class="drawer" id="drawer">
  <a href="index.html">üè† Dashboard</a>
  <a href="entradas.html">üíµ Caixa</a>
  <a href="resumo.html">üìä Resumo</a>
  <a href="calculadora.html">üìü Calculadora</a>
  <a href="planos.html">üíé Planos</a>
  <a href="perfil.html">üë§ Perfil</a>
  <a href="recibo_empresa.html">üè≠ Empresas</a>
  <a href="recibo_particular.html">üöò Particular</a>
  <a href="manutencao.html">üõ† Manuten√ß√£o</a>
</nav>

<div class="page-header">
  <h1>Recibo Particular</h1>
  <div class="sub">Emita recibos individuais para passageiros.</div>

  <div class="tabs">
    <div id="tabCadastro" class="tab-btn active" data-tab="cadastro">Cadastro</div>
    <div id="tabEmitir" class="tab-btn" data-tab="emitir">Emitir</div>
    <div id="tabHistorico" class="tab-btn" data-tab="historico">Hist√≥rico</div>
  </div>
</div>

<div class="container">

  <!-- ============== ABA CADASTRO ============== -->
  <section id="abaCadastro" class="card">
    <h3>Dados do motorista</h3>
    <div class="row">
      <div class="col">
        <label>Nome do motorista</label>
        <input id="motNome" type="text" placeholder="Seu nome completo">
      </div>
      <div class="col">
        <label>CPF ou CNPJ (opcional)</label>
        <input id="motCpf" type="text" placeholder="000.000.000-00">
      </div>
    </div>

    <div class="row">
      <div class="col">
        <label>Ve√≠culo</label>
        <input id="motVeiculo" type="text" placeholder="Ex: Corolla">
      </div>
      <div class="col">
        <label>Placa</label>
        <input id="motPlaca" type="text" placeholder="ABC-1D23">
      </div>
      <div class="col">
        <label>Cor</label>
        <input id="motCor" type="text" placeholder="Preto">
      </div>
    </div>

    <button id="saveMotorista">Salvar motorista</button>
  </section>

  <!-- ============== ABA EMITIR ============== -->
  <section id="abaEmitir" class="card" style="display:none;">
    <h3>Dados do passageiro</h3>

    <label>Nome do passageiro</label>
    <input id="nomePassageiro" type="text" placeholder="Nome do passageiro">

    <label>Origem</label>
    <input id="origem" type="text" placeholder="Ponto de in√≠cio da viagem">

    <label>Destino</label>
    <input id="destino" type="text" placeholder="Destino da viagem">

    <h3 style="margin-top:18px;">Dados da viagem</h3>

    <label>Valor (R$)</label>
    <input id="valor" type="number" step="0.01" placeholder="0,00">

    <label>Data da viagem</label>
    <input id="dataViagem" type="date">

    <label>Tempo aproximado (ex: 35 min)</label>
    <input id="tempo" type="text" placeholder="Ex: 35 min">

    <label>KM aproximado</label>
    <input id="km" type="number" step="0.1" placeholder="0,0">

    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;">
      <button id="emitirPdf">Gerar PDF</button>
      <button id="enviarWa" style="background:#128c7e;color:#fff;">Enviar WhatsApp</button>
    </div>
  </section>

  <!-- ============== ABA HIST√ìRICO ============== -->
  <section id="abaHistorico" class="card" style="display:none;">
    <h3>Hist√≥rico de recibos</h3>
    <div id="lista"></div>
  </section>

</div> <!-- ./container -->

<!-- Tabbar inferior -->
<div class="tabbar">
  <a href="index.html">üè†<small>Home</small></a>
  <a href="entradas.html">üíµ<small>Caixa</small></a>
  <button class="action-btn" onclick="location.href='calculadora.html'">+</button>
  <a href="resumo.html">üìä<small>Resumo</small></a>
  <a href="perfil.html">üë§<small>Perfil</small></a>
</div>

<script src="planos.js"></script>
<script>
/* ============================
   BLOQUEIO POR PLANO
   (Dispon√≠vel a partir do Premium)
============================ */
function planoAtual(){
  try{
    if(typeof getPlano === "function"){
      return (getPlano() || localStorage.getItem("planoAtual") || "free").toLowerCase();
    }
  }catch(e){}
  return (localStorage.getItem("planoAtual") || "free").toLowerCase();
}

(function(){
  const p = planoAtual();
  if(p !== "premium" && p !== "pro"){
    alert("A p√°gina Recibo Particular est√° dispon√≠vel a partir do plano Premium.");
    window.location.href = "planos.html";
  }
})();

/* ============================
   HELPERS + STORAGE KEYS
============================ */
const $ = id => document.getElementById(id);

const HIST_KEY       = "histParticular";
const MOTORISTA_KEY  = "motoristaParticular";

function loadHist(){
  try{
    return JSON.parse(localStorage.getItem(HIST_KEY) || "[]");
  }catch(e){
    return [];
  }
}
function saveHist(arr){
  localStorage.setItem(HIST_KEY, JSON.stringify(arr));
}

/* ============================
   MOTORISTA (CADASTRO)
============================ */
function getMotorista(){
  try{
    return JSON.parse(localStorage.getItem(MOTORISTA_KEY) || "{}");
  }catch(e){
    return {};
  }
}
function fillMotorista(){
  const m = getMotorista();
  if($("motNome"))    $("motNome").value    = m.nome    || "";
  if($("motCpf"))     $("motCpf").value     = m.cpf     || "";
  if($("motVeiculo")) $("motVeiculo").value = m.veiculo || "";
  if($("motPlaca"))   $("motPlaca").value   = m.placa   || "";
  if($("motCor"))     $("motCor").value     = m.cor     || "";
}

if($("saveMotorista")){
  $("saveMotorista").addEventListener("click", ()=>{
    const data = {
      nome:    $("motNome")?.value    || "",
      cpf:     $("motCpf")?.value     || "",
      veiculo: $("motVeiculo")?.value || "",
      placa:   $("motPlaca")?.value   || "",
      cor:     $("motCor")?.value     || ""
    };
    localStorage.setItem(MOTORISTA_KEY, JSON.stringify(data));
    alert("Dados do motorista salvos!");
  });
}

/* ============================
   THEME (claro/escuro)
============================ */
function applyTheme(theme){
  const body = document.body;
  const btn  = $("toggleTheme");

  if(theme === "dark"){
    body.classList.add("dark");
    body.classList.remove("light");
    localStorage.setItem("theme","dark");
    if(btn) btn.innerText = "‚òÄÔ∏è";
  }else{
    body.classList.add("light");
    body.classList.remove("dark");
    localStorage.setItem("theme","light");
    if(btn) btn.innerText = "üåô";
  }
}

function toggleTheme(){
  const isDark = document.body.classList.contains("dark");
  applyTheme(isDark ? "light" : "dark");
}

/* ============================
   DRAWER LATERAL
============================ */
function toggleDrawer(){
  const dr = $("drawer");
  if(dr) dr.classList.toggle("open");
}

/* ============================
   ABAS INTERNAS
============================ */
function setAba(nome){
  const map = {
    cadastro:  "abaCadastro",
    emitir:    "abaEmitir",
    historico: "abaHistorico"
  };

  ["cadastro","emitir","historico"].forEach(tabName=>{
    const tabEl = document.querySelector(`.tab-btn[data-tab="${tabName}"]`) ||
                  document.getElementById("tab" + tabName.charAt(0).toUpperCase() + tabName.slice(1));
    const secId = map[tabName];
    const secEl = $(secId);

    if(tabEl) tabEl.classList.toggle("active", tabName === nome);
    if(secEl) secEl.style.display = (tabName === nome ? "block" : "none");
  });
}

/* Eventos das abas (Cadastro / Emitir / Hist√≥rico) */
document.querySelectorAll(".tab-btn").forEach(tab=>{
  tab.addEventListener("click", ()=>{
    const nome = tab.dataset.tab;
    if(nome) setAba(nome);
  });
});

/* Abre direto na aba Emitir no uso di√°rio */
setAba("emitir");

/* ============================
   PERMISS√ïES POR PLANO
   (Premium x Pro)
============================ */
function aplicarPermissoes(){
  const p = planoAtual();
  const btnPdf = $("emitirPdf");

  if(btnPdf){
    // Se Premium: mostra bot√£o, mas desativado visualmente
    if(p === "premium"){
      btnPdf.disabled = false;  // ainda clicamos, mas JS vai bloquear na a√ß√£o
      btnPdf.style.opacity = ".45";
      btnPdf.textContent = "Gerar PDF (Pro)";
    }else{
      btnPdf.disabled = false;
      btnPdf.style.opacity = "1";
      btnPdf.textContent = "Gerar PDF";
    }
  }
}

/* ============================
   INICIALIZA√á√ÉO DE TEMA
============================ */
(function initTheme(){
  const saved = localStorage.getItem("theme") || "light";
  applyTheme(saved);
})();
</script>
<script>
/* ============================================
   HIST√ìRICO (CRUD)
============================================ */
function renderHistorico(){
  const box = $("listaRecibos") || $("lista"); // compatibilidade
  if(!box) return;

  const arr = loadHist();
  if(!arr.length){
    box.innerHTML = "<div style='font-size:13px;color:var(--muted)'>Sem recibos at√© o momento.</div>";
    return;
  }

  box.innerHTML = "";
  arr.forEach(r=>{
    const item = document.createElement("div");
    item.className = "hist-item";
    item.innerHTML = `
      <div class="hist-main">
        <strong>${r.data || "-"}</strong>
        <span>${r.nome || "-"}</span>
      </div>
      <div class="hist-actions">
        <button class="btn-sm pdf" onclick="baixarRecibo(${r.id})">PDF</button>
        <button class="btn-sm del" onclick="excluirRecibo(${r.id})">Excluir</button>
      </div>
    `;
    box.appendChild(item);
  });
}

/* ============================================
   EXCLUIR
============================================ */
function excluirRecibo(id){
  if(!confirm("Excluir este recibo?")) return;
  let arr = loadHist();
  arr = arr.filter(x => x.id !== id);
  saveHist(arr);
  renderHistorico();
}

/* deixar global */
window.excluirRecibo = excluirRecibo;

/* ============================================
   PDF PARTICULAR
============================================ */
function gerarPdfParticular(d){
  const p = planoAtual();
  if(p !== "pro"){
    alert("PDF dispon√≠vel apenas no plano PRO");
    return;
  }

  const m = getMotorista();
  if(!window.jspdf || !window.jspdf.jsPDF){
    alert("Biblioteca jsPDF n√£o encontrada");
    return;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p","mm","a4");
  const W = doc.internal.pageSize.getWidth();
  let y  = 15;

  doc.setFontSize(18);
  doc.text("RECIBO DE VIAGEM PARTICULAR", W/2, y, {align:"center"});
  y += 10;

  /* Caixa */
  function sec(titulo, linhas){
    const lh = 5;
    const h  = 8 + linhas.length*lh + 4;
    doc.setDrawColor(150);
    doc.roundedRect(15, y, W-30, h, 2, 2);
    doc.setFontSize(12);
    doc.text(titulo, 18, y+6);

    doc.setFontSize(10);
    let yy = y+14;
    linhas.forEach(l=>{
      doc.text(l, 18, yy);
      yy += lh;
    });
    y += h+5;
  }

  sec("Motorista", [
    "Nome: "      + (m.nome    || "-"),
    "CPF/CNPJ: "  + (m.cpf     || "-"),
    "Ve√≠culo: "   + (m.veiculo || "-"),
    "Placa: "     + (m.placa   || "-"),
    "Cor: "       + (m.cor     || "-")
  ]);

  sec("Passageiro", [
    "Nome: "   + (d.nome   || "-"),
    "Origem: " + (d.origem || "-"),
    "Destino: "+ (d.destino|| "-")
  ]);

  sec("Dados da viagem", [
    "Data: "  + (d.data  || "-"),
    "Valor: R$ " + (d.valor || "-"),
    "Tempo: " + (d.tempo || "-"),
    "KM: "    + (d.km    || "-")
  ]);

  y += 10;
  doc.text("__________________________________", 20, y);
  doc.text("__________________________________", 110, y);
  y += 6;
  doc.text((d.nome || "-"), 20, y);
  doc.text((m.nome || "-"), 110, y);

  doc.save("recibo_particular.pdf");
}

/* ============================================
   DOWNLOAD RECEBOS (hist√≥rico)
============================================ */
function baixarRecibo(id){
  const p = planoAtual();
  if(p !== "pro"){
    alert("Download dispon√≠vel apenas no plano PRO");
    return;
  }
  const arr = loadHist();
  const d = arr.find(x=>x.id===id);
  if(d) gerarPdfParticular(d);
}
window.baixarRecibo = baixarRecibo;

/* ============================================
   EMITIR PDF
============================================ */
const btnEmitir = $("emitirPdf");
if(btnEmitir){
  btnEmitir.addEventListener("click", ()=>{
    const d = {
      id:     Date.now(),
      nome:   $("nomePassageiro")?.value || "",
      origem: $("origem")?.value        || "",
      destino:$("destino")?.value       || "",
      valor:  $("valor")?.value         || "",
      data:   $("dataViagem")?.value    || "",
      tempo:  $("tempo")?.value         || "",
      km:     $("km")?.value            || ""
    };

    const p = planoAtual();
    if(p === "pro"){
      gerarPdfParticular(d);
    }else{
      alert("PDF dispon√≠vel apenas no plano PRO");
      return;
    }

    let arr = loadHist();
    arr.unshift(d);
    saveHist(arr);
    renderHistorico();
    setAba("historico");
  });
}

/* ============================================
   WHATSAPP
============================================ */
const btnWa = $("enviarWa");
if(btnWa){
  btnWa.addEventListener("click", ()=>{
    const p = planoAtual();
    if(p === "premium" || p === "pro"){
      const msg = 
`RECIBO PARTICULAR

Passageiro: ${$("nomePassageiro").value}
Origem: ${$("origem").value}
Destino: ${$("destino").value}
Data: ${$("dataViagem").value}
Valor: R$ ${$("valor").value}
Tempo: ${$("tempo").value}
KM: ${$("km").value}`;

      window.open("https://wa.me/?text="+encodeURIComponent(msg));
    }else{
      alert("WhatsApp dispon√≠vel apenas no plano Premium ou Pro");
    }
  });
}

/* ============================================
   BOOT FINAL
============================================ */
(function boot(){
  aplicarPermissoes();
  fillMotorista();
  renderHistorico();
})();
</script>

</body>
</html>
