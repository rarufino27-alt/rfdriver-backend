<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Calculadora - RF Driver</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>

/* ==============================
   PALETA GOLD PADR√ÉO DO APP
=================================*/
:root{
  --gold-dark:#d6b25f;
  --gold-dark2:#e8d08a;

  --gold-light:#90731b;
  --gold-light2:#b08c2e;

  --bg-dark:#0d0d0d;
  --text-dark:#f4f4f4;
  --card-dark:#161616;
  --border-dark:#242424;

  --bg-light:#f7f7f7;
  --text-light:#222;
  --card-light:#ffffff;
  --border-light:#d6d6d6;

  --accent-success:#1DB954;
  --accent-danger:#ff3b30;

  --radius:14px;
}

/* DARK */
body.dark{
  --bg:var(--bg-dark);
  --text:var(--text-dark);
  --card:var(--card-dark);
  --border:var(--border-dark);
  --gold-main:var(--gold-dark);
  --gold-main2:var(--gold-dark2);
}

/* LIGHT */
body.light{
  --bg:var(--bg-light);
  --text:var(--text-light);
  --card:var(--card-light);
  --border:var(--border-light);
  --gold-main:var(--gold-light);
  --gold-main2:var(--gold-light2);
}

/* BASE */
*{ box-sizing:border-box; font-family:Inter,system-ui; }

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  padding-bottom:160px;
  padding-top:70px;
  transition:.3s;
}

/******************************************
 MENU LATERAL
*******************************************/
.drawer{
  position:fixed; top:0; left:-260px;
  width:260px; height:100%;
  background:var(--card);
  transition:left .3s;
  z-index:9999;
  padding-top:70px;
}
.drawer.open{ left:0; }

.drawer a{
  display:block;
  padding:15px 22px;
  border-bottom:1px solid var(--border);
  text-decoration:none;
  font-size:17px;
  color:var(--text);
}

.drawer-toggle{
  position:fixed;
  left:15px; top:15px;
  font-size:28px;
  cursor:pointer;
  z-index:10000;
  color:var(--gold-main);
}

.theme-toggle{
  position:fixed;
  right:15px; top:15px;
  font-size:24px;
  cursor:pointer;
  z-index:10001;
  color:var(--gold-main);
}

/******************************************
 TABBAR INFERIOR
*******************************************/
.tabbar{
  position:fixed;
  bottom:0; left:0; right:0;
  height:70px;
  background:var(--card);
  border-top:1px solid var(--border);
  display:flex; justify-content:space-around;
  align-items:center;
  z-index:9990;
}
.tabbar a{
  text-decoration:none;
  text-align:center;
  font-size:20px;
  flex:1;
  color:var(--text);
}
.tabbar small{ font-size:12px; display:block; }
.tabbar a.active{ color:var(--gold-main); }

.action-btn{
  background:linear-gradient(90deg,var(--gold-main),var(--gold-main2));
  width:58px; height:58px;
  border:none; border-radius:30px;
  color:#000; font-size:26px;
  display:flex; align-items:center; justify-content:center;
  margin-top:-35px;
  box-shadow:0 0 12px rgba(0,0,0,.5);
}

/****************************************
 HEADER
*****************************************/
h1{
  font-weight:800;
  margin:0;
  font-size:28px;
  color:var(--gold-main);
}

.sub{
  font-size:14px;
  opacity:.75;
  margin-top:4px;
}

/****************************************
 CONTAINER
*****************************************/
.container{
  padding:20px;
}

/****************************************
 CARDS
*****************************************/
.card{
  margin-top:18px;
  background:var(--card);
  padding:18px;
  border-radius:var(--radius);
  border:1px solid var(--border);
}
/* ABAS */
.tab-buttons{
  display:flex;
  gap:8px;
  margin-top:10px;
}
.tab-btn{
  flex:1;
  padding:12px;
  text-align:center;
  background:var(--card);
  border-radius:var(--radius);
  border:1px solid var(--border);
  cursor:pointer;
  font-weight:700;
  color:var(--text);
}
.tab-btn.active{
  background:linear-gradient(90deg,var(--gold-main),var(--gold-main2));
  color:#000;
}

/* INPUTS */
label{
  display:block;
  font-size:14px;
  margin-top:10px;
}
input,select{
  width:100%;
  padding:12px;
  border-radius:var(--radius);
  border:1px solid var(--border);
  background:var(--card);
  color:var(--text);
  margin-top:6px;
}

/* BOT√ïES */
button{
  padding:12px;
  border-radius:var(--radius);
  background:linear-gradient(90deg,var(--gold-main),var(--gold-main2));
  color:#000;
  font-weight:700;
  border:none;
  margin-top:12px;
  cursor:pointer;
}

/* RESULT BLOCK */
.resultado{
  background:var(--card);
  padding:14px;
  border-radius:var(--radius);
  border:1px solid var(--border);
  white-space:pre-line;
  margin-top:12px;
}

/* small text */
.small{ font-size:12px; opacity:.7; }

</style>
</head>

<body>

<!-- BOT√ïES SUPERIORES -->
<div class="drawer-toggle" onclick="toggleDrawer()">‚ò∞</div>
<div id="toggleTheme" class="theme-toggle" onclick="toggleTheme()">üåì</div>

<!-- MENU LATERAL -->
<nav class="drawer" id="drawer">
  <a href="index.html">üè† Dashboard</a>
  <a href="entradas.html">üíµ Caixa</a>
  <a href="resumo.html">üìä Resumo</a>
  <a href="calculadora.html">üìü Calculadora</a>
  <a href="planos.html">üíé Planos</a>
  <a href="perfil.html">üë§ Perfil</a>
  <a href="recibo_empresa.html">üè≠ Empresa</a>
  <a href="recibo_particular.html">üöò Particular</a>
  <a href="manutencao.html">üõ† Manuten√ß√£o</a>
</nav>

<div class="container">

<!-- HEADER -->
<h1>Calculadora</h1>
<div class="sub">Simula√ß√µes r√°pidas e avan√ßadas para motoristas.</div>

<!-- ABAS -->
<div class="tab-buttons">
  <div id="tabSimples" class="tab-btn active">Simples</div>
  <div id="tabPremium" class="tab-btn">Premium ‚≠ê</div>
</div>

<!-- ABA SIMPLES -->
<section id="abaSimples" class="card" style="display:block">
  <h2>Calculadora Simples</h2>

  <label>Motorista</label><input id="motorista">
  <label>CPF/CNPJ</label><input id="cpfCnpj">
  <label>Carro / Modelo</label><input id="carro">
  <label>Placa</label><input id="placa">
  <label>Origem</label><input id="origem">
  <label>Destino</label><input id="destino">

  <label>Valor por KM</label><input id="valorKm" type="number" step="0.01">
  <label>KM Rodado</label><input id="kmRodado" type="number" step="0.01">
  <label>Dura√ß√£o (minutos)</label><input id="duracaoMin" type="number">

  <label>Tipo de uso</label>
  <select id="tipoUso">
    <option value="cidade">Cidade</option>
    <option value="pista">Pista</option>
  </select>

  <label>Tipo de viagem</label>
  <select id="tipoViagem">
    <option value="soIdaComVolta">S√≥ ida (com volta)</option>
    <option value="soIdaSemVolta">S√≥ ida (sem volta)</option>
    <option value="idaVoltaEspera">Ida e volta + espera</option>
    <option value="idaVolta">Ida e volta</option>
    <option value="bateVolta">Bate e volta</option>
  </select>

  <button id="btnCalcularSimples">Calcular Estimativa</button>
  <button id="btnEnviarWhatsSimples" style="background:#128c7e;color:#fff">Enviar WhatsApp</button>

  <div id="resultadoSimples" class="resultado"></div>
</section>

<!-- ABA PREMIUM -->
<section id="abaPremium" class="card" style="display:none">
  <h2>Calculadora Premium ‚≠ê</h2>
  <p class="small">C√°lculos avan√ßados: combust√≠veis, plataformas, lucro, gr√°fico e hist√≥rico.</p>

  <div class="card">
    <h3>Gasolina / Etanol</h3>
    <label>Pre√ßo Gasolina (R$/L)</label><input id="gasolinaPreco" type="number" step="0.01">
    <label>Consumo Gasolina (km/L)</label><input id="gasolinaConsumo" type="number" step="0.1">
    <label>Pre√ßo Etanol (R$/L)</label><input id="etanolPreco" type="number" step="0.01">
    <label>Consumo Etanol (km/L)</label><input id="etanolConsumo" type="number" step="0.1">
    <button id="btnSalvarComb">Salvar Combust√≠veis</button>
  </div>
  <!-- GNV -->
  <div class="card">
    <h3>GNV</h3>
    <label>Pre√ßo do Cilindro Cheio (R$)</label><input id="gnvPrecoCilindro" type="number">
    <label>Autonomia Total (km)</label><input id="gnvAutonomiaKm" type="number">
    <label>Capacidade (m¬≥)</label><input id="gnvCapacidade" type="number">

    <hr>

    <label>Pre√ßo por m¬≥ (auto)</label><input id="gnvPrecoPorM3" readonly>
    <label>Autonomia por m¬≥ (km/m¬≥)</label><input id="gnvAutonomiaPorM3" readonly>

    <button id="btnSalvarGnv">Salvar GNV</button>
  </div>

  <!-- Dados da corrida -->
  <div class="card">
    <h3>Dados da Corrida</h3>

    <label>Km at√© passageiro</label><input id="kmIda" type="number" value="1">
    <label>Km da corrida</label><input id="kmViagem" type="number" value="8">
    <label>Valor recebido (R$)</label><input id="valorRecebido" type="number" value="18.50">

    <label>Taxas das plataformas (%)</label>
    <div style="display:flex;gap:8px">
      <input id="taxUber" type="number" value="25" placeholder="Uber">
      <input id="tax99" type="number" value="24" placeholder="99">
      <input id="taxIndriver" type="number" value="10" placeholder="InDriver">
    </div>

    <label>Combust√≠vel</label>
    <select id="tipoCombustivel">
      <option value="gasolina">Gasolina</option>
      <option value="etanol">Etanol</option>
      <option value="gnv">GNV</option>
      <option value="auto">Autom√°tico (mais barato)</option>
    </select>

    <button id="btnCalcPremium">Calcular Premium</button>
    <button id="btnExportPdf" style="background:var(--gold-main)">Exportar PDF</button>
    <button id="btnWhatsPremium" style="background:#128c7e;color:#fff">Enviar WhatsApp</button>
    <button id="btnLimparHist" style="background:var(--accent-danger);color:#fff">Limpar Hist√≥rico</button>
  </div>

  <div id="r_cck" class="resultado"></div>
  <div id="r_lucro" class="resultado"></div>
  <div id="r_combustivelMaisBarato" class="resultado"></div>
  <div id="r_melhorPlataforma" class="resultado"></div>
  <div id="r_indicacao" class="resultado"></div>
  <div id="r_comp" style="margin-top:14px"></div>

  <div id="graficoPremium" class="card"></div>
  <div id="historicoPremium" class="card"></div>
</section>

</div><!-- ./container -->

<!-- MENU INFERIOR -->
<div class="tabbar">
  <a href="index.html">üè†<small>Home</small></a>
  <a href="entradas.html">üíµ<small>Caixa</small></a>
  <button class="action-btn" onclick="location.href='calculadora.html'">+</button>
  <a href="resumo.html">üìä<small>Resumo</small></a>
  <a href="planos.html">üíé<small>Planos</small></a>
</div>

<script src="planos.js"></script>

<script>
/* =====================
   BLOQUEIO POR PLANO
===================== */
(function aplicarBloqueioPorPlano(){
  if(typeof planoTem === "function"){
    // free -> bloqueia tudo
    if(!planoTem("calc_simple")){
      alert("A Calculadora est√° dispon√≠vel apenas a partir do plano B√°sico.");
      location.href="planos.html";
      return;
    }
    // b√°sico -> simples apenas
    if(planoTem("calc_simple") && !planoTem("calc_premium")){
      document.getElementById('tabPremium').style.display='none';
      document.getElementById('abaPremium').style.display='none';
    }
  }
})();
</script>

<script>
/* =====================
   THEME GOLD
===================== */
function toggleDrawer(){
  document.getElementById("drawer").classList.toggle("open");
}

function toggleTheme(){
  const dark = document.body.classList.contains("dark");
  if(dark){
    document.body.classList.remove("dark");
    document.body.classList.add("light");
    localStorage.setItem("theme","light");
    document.getElementById("toggleTheme").innerText="üåô";
  } else {
    document.body.classList.add("dark");
    document.body.classList.remove("light");
    localStorage.setItem("theme","dark");
    document.getElementById("toggleTheme").innerText="‚òÄÔ∏è";
  }
}

// inicia o tema salvo
(function(){
  const saved = localStorage.getItem("theme") || "light";
  if(saved==="dark"){
    document.body.classList.add("dark");
    document.getElementById("toggleTheme").innerText="‚òÄÔ∏è";
  } else {
    document.body.classList.add("light");
    document.getElementById("toggleTheme").innerText="üåô";
  }
})();

/* =====================
   ABAS
===================== */
const tabSimples  = document.getElementById('tabSimples');
const tabPremium  = document.getElementById('tabPremium');
const abaSimples  = document.getElementById('abaSimples');
const abaPremium  = document.getElementById('abaPremium');

tabSimples.onclick = ()=>{
  tabSimples.classList.add('active');
  tabPremium.classList.remove('active');
  abaSimples.style.display='block';
  abaPremium.style.display='none';
};

if(tabPremium){
  tabPremium.onclick = ()=>{
    tabPremium.classList.add('active');
    tabSimples.classList.remove('active');
    abaSimples.style.display='none';
    abaPremium.style.display='block';
  };
}
</script>

<script>
/* === C√ìDIGOS ORIGINAIS COMPLETOS === */
/* (todo o JS original da calculadora, sem nenhuma remo√ß√£o) */

/* keys */
const PERFIL_KEY = 'perfilCalc_v2',
      COMB_KEY   = 'combPremium_v2',
      GNV_KEY    = 'gnvPremium_v2',
      HIST_KEY   = 'premiumHist_v2';

/* perfil */
function salvarPerfilLocal(){
  const p = {
    motorista: motorista.value,
    cpfCnpj : cpfCnpj.value,
    carro   : carro.value,
    placa   : placa.value
  };
  localStorage.setItem(PERFIL_KEY, JSON.stringify(p));
}
function carregarPerfilLocal(){
  const p = JSON.parse(localStorage.getItem(PERFIL_KEY) || '{}');
  if(p.motorista) motorista.value = p.motorista;
  if(p.cpfCnpj)  cpfCnpj.value   = p.cpfCnpj;
  if(p.carro)    carro.value     = p.carro;
  if(p.placa)    placa.value     = p.placa;
}
['motorista','cpfCnpj','carro','placa'].forEach(id=>{
  document.getElementById(id).addEventListener('input', salvarPerfilLocal);
});
carregarPerfilLocal();

/* simples */
const btnCalcularSimples = document.getElementById('btnCalcularSimples');
btnCalcularSimples.onclick = ()=>{
  const km = Number(kmRodado.value) || 0;
  const valKm = Number(valorKm.value)  || 0;
  if(!km||!valKm){
    alert("Preencha valor por km e km rodado.");
    return;
  }
  const bruto = km*valKm;
  resultadoSimples.innerText =
`Motorista: ${motorista.value||'-'}
Origem: ${origem.value||'-'} | Destino: ${destino.value||'-'}
Valor Bruto: R$ ${bruto.toFixed(2)}
Dura√ß√£o: ${Number(duracaoMin.value||0)} min`;
};
btnEnviarWhatsSimples.onclick = ()=>{
  const msg = resultadoSimples.innerText || "";
  window.open("https://wa.me/?text="+encodeURIComponent(msg));
};

/* premium */
function fmt(v){
  if(v===Infinity||isNaN(v)) return 'N/D';
  return 'R$ '+Number(v).toFixed(2);
}

/* combustiveis */
function calcularCustosCombustiveis(){
  const c = JSON.parse(localStorage.getItem(COMB_KEY)||'{}');
  const g = JSON.parse(localStorage.getItem(GNV_KEY)||'{}');
  return {
    gasCost: c.gasolinaPreco && c.gasolinaConsumo ? c.gasolinaPreco/c.gasolinaConsumo : Infinity,
    etaCost: c.etanolPreco   && c.etanolConsumo   ? c.etanolPreco/c.etanolConsumo     : Infinity,
    gnvCost: g.precoCilindro && g.autonomiaKm     ? g.precoCilindro/g.autonomiaKm     : Infinity
  };
}
btnSalvarComb.onclick = ()=>{
  const c = {
    gasolinaPreco   : Number(gasolinaPreco.value)||0,
    gasolinaConsumo : Number(gasolinaConsumo.value)||0,
    etanolPreco     : Number(etanolPreco.value)||0,
    etanolConsumo   : Number(etanolConsumo.value)||0
  };
  localStorage.setItem(COMB_KEY, JSON.stringify(c));
  alert('Combust√≠veis salvos!');
};

/* gnv */
function atualizarGnvAutomatico(){
  const preco=Number(gnvPrecoCilindro.value)||0,
        aut=Number(gnvAutonomiaKm.value)||0,
        cap=Number(gnvCapacidade.value)||0;
  if(cap>0){
    gnvPrecoPorM3.value=(preco/cap).toFixed(2);
    gnvAutonomiaPorM3.value=(aut/cap).toFixed(2);
  } else {
    gnvPrecoPorM3.value='';
    gnvAutonomiaPorM3.value='';
  }
}
['gnvPrecoCilindro','gnvAutonomiaKm','gnvCapacidade'].forEach(id=>{
  document.getElementById(id).addEventListener('input', atualizarGnvAutomatico);
});
btnSalvarGnv.onclick = ()=>{
  const g={
    precoCilindro:Number(gnvPrecoCilindro.value)||0,
    autonomiaKm:Number(gnvAutonomiaKm.value)||0,
    capacidade:Number(gnvCapacidade.value)||0,
    precoPorM3:Number(gnvPrecoPorM3.value)||0,
    autonomiaPorM3:Number(gnvAutonomiaPorM3.value)||0
  };
  localStorage.setItem(GNV_KEY, JSON.stringify(g));
  alert('GNV salvo!');
};

/* corrida premium */
function calcularPlataformas(valor,custo){
  return {
    uber     : valor-custo-(valor*(Number(taxUber.value)/100)),
    novenove : valor-custo-(valor*(Number(tax99.value)/100)),
    indriver : valor-custo-(valor*(Number(taxIndriver.value)/100))
  };
}
btnCalcPremium.onclick = ()=>{
  const kmTotal=Number(kmIda.value||0)+Number(kmViagem.value||0);
  const valor=Number(valorRecebido.value||0);
  const tipo=tipoCombustivel.value;
  const {gasCost,etaCost,gnvCost} = calcularCustosCombustiveis();
  let custoEscolhido=Infinity, nome='N/D';
  if(tipo==='gasolina'){ custoEscolhido=gasCost; nome='Gasolina'; }
  else if(tipo==='etanol'){ custoEscolhido=etaCost; nome='Etanol'; }
  else if(tipo==='gnv'){ custoEscolhido=gnvCost; nome='GNV'; }
  else {
    const menor=Math.min(gasCost,etaCost,gnvCost);
    custoEscolhido=menor;
    nome=(menor===gasCost?'Gasolina':menor===etaCost?'Etanol':'GNV');
  }
  const custoTotal = kmTotal*custoEscolhido;
  const {uber,novenove,indriver}=calcularPlataformas(valor,custoTotal);
  const melhor=Math.max(uber,novenove,indriver);
  const melhorPlataforma = melhor===uber?'Uber':melhor===novenove?'99':'InDriver';
  r_cck.innerText=fmt(custoEscolhido);
  r_combustivelMaisBarato.innerText=nome;
  r_melhorPlataforma.innerText=`${melhorPlataforma} (${fmt(melhor)})`;
  r_lucro.innerText=fmt(melhor);
  r_indicacao.innerText=melhor>0?'ACEITE':'N√ÉO VALE A PENA';
  r_comp.innerHTML=
  `<div style="padding:10px;background:var(--card);border-radius:10px">
    <b>Comparativo combust√≠veis</b><br>
    Gasolina: ${fmt(gasCost)} ‚Äî Etanol: ${fmt(etaCost)} ‚Äî GNV: ${fmt(gnvCost)}
  </div>`;

  salvarHistorico({t:Date.now(), km:kmTotal, lucro:melhor, comb:nome, platform:melhorPlataforma});
  renderHistorico();
  renderGrafico();
};

/* HIST */
function salvarHistorico(item){
  const arr=JSON.parse(localStorage.getItem(HIST_KEY)||'[]');
  arr.push(item);
  if(arr.length>300) arr.shift();
  localStorage.setItem(HIST_KEY, JSON.stringify(arr));
}
function renderHistorico(){
  const arr=JSON.parse(localStorage.getItem(HIST_KEY)||'[]');
  if(!arr.length){
    historicoPremium.innerHTML="<h3>Hist√≥rico</h3><p class='small'>Nenhum dado.</p>";
    return;
  }
  let html="<h3>Hist√≥rico Premium</h3><table><tr><th>Data</th><th>KMs</th><th>Lucro</th><th>Comb</th><th>Plat</th></tr>";
  arr.slice().reverse().forEach(r=>{
    html+=`<tr><td>${new Date(r.t).toLocaleString()}</td><td>${r.km}</td><td>${fmt(r.lucro)}</td><td>${r.comb}</td><td>${r.platform}</td></tr>`;
  });
  html+="</table>";
  historicoPremium.innerHTML=html;
}
renderHistorico();

/* GRAFICO */
function renderGrafico(){
  const arr=JSON.parse(localStorage.getItem(HIST_KEY)||'[]');
  if(!arr.length){
    graficoPremium.innerHTML="<h3>Gr√°fico</h3><p class='small'>Nenhum dado.</p>";
    return;
  }
  let html="<h3>Lucro (√öltimas corridas)</h3>";
  arr.slice(-12).forEach(r=>{
    const w=Math.min(300, Math.abs(r.lucro)*3);
    const cor=r.lucro>=0?'var(--accent-success)':'var(--accent-danger)';
    html+=`<div style="margin-bottom:6px">
      <div style="display:inline-block;height:12px;background:${cor};width:${w}px;border-radius:6px"></div>
      <small>${fmt(r.lucro)}</small></div>`;
  });
  graficoPremium.innerHTML=html;
}
renderGrafico();

/* PDF */
btnExportPdf.onclick=()=>{
  const html=`
  <html><body>
  <h2>Relat√≥rio Premium - RF Driver</h2>
  <p>Custo por KM: ${r_cck.innerText}</p>
  <p>Lucro L√≠quido: ${r_lucro.innerText}</p>
  <p>Melhor Plataforma: ${r_melhorPlataforma.innerText}</p>
  </body></html>`;
  const w=window.open();
  w.document.write(html);
  w.print();
};

/* Whats Premium */
btnWhatsPremium.onclick=()=>{
  const msg=
`üìü Relat√≥rio Premium
Custo/KM: ${r_cck.innerText}
Lucro: ${r_lucro.innerText}
Plataforma: ${r_melhorPlataforma.innerText}`;
  window.open("https://wa.me/?text="+encodeURIComponent(msg));
};

/* limpar */
btnLimparHist.onclick=()=>{
  if(confirm("Limpar hist√≥rico?")){
    localStorage.removeItem(HIST_KEY);
    renderHistorico();
    renderGrafico();
  }
};
</script>

</body>
</html>
